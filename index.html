<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Debt Calculator (KDX Rule)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: linear-gradient(135deg,#f9fafb,#e2e8f0); }
    input:focus { outline: 2px solid #3b82f6; outline-offset: 2px; }
  </style>
</head>

<body class="flex items-center justify-center min-h-screen p-4">
  <div class="bg-white w-full max-w-md p-6 rounded-2xl shadow-xl">
    <h1 class="text-2xl font-bold text-center mb-6 text-blue-600">ðŸ’° Debt Calculator (KDX Rule)</h1>

    <div class="space-y-4">
      <div>
        <label class="block font-medium">Contract Date</label>
        <input id="contractDate" type="date" class="w-full border rounded-lg p-2">
      </div>

      <div>
        <label class="block font-medium">Due Date</label>
        <input id="dueDate" type="date" class="w-full border rounded-lg p-2">
      </div>

      <div>
        <label class="block font-medium">Paid Date</label>
        <input id="paidDate" type="date" class="w-full border rounded-lg p-2">
      </div>

      <div>
        <label class="block font-medium">Summary Price (à¸¿)</label>
        <input id="summaryPrice" type="number" class="w-full border rounded-lg p-2" placeholder="e.g. 10000">
      </div>

      <button onclick="calculateDebt()" class="w-full bg-blue-500 text-white py-2 rounded-lg font-semibold hover:bg-blue-600 active:bg-blue-700">
        Calculate
      </button>

      <div id="result" class="mt-6 hidden bg-gray-50 p-4 rounded-lg border">
        <h2 class="text-lg font-semibold mb-2 text-gray-700">ðŸ“‹ Result</h2>
        <p><strong>Base Months:</strong> <span id="rBaseMonths"></span></p>
        <p><strong>Base Amount:</strong> à¸¿<span id="rBaseAmount"></span></p>
        <p><strong>Penalty Months:</strong> <span id="rPenaltyMonths"></span></p>
        <p><strong>Late Interest (5%/yr):</strong> à¸¿<span id="rLate"></span></p>
        <p class="text-blue-600 font-semibold text-lg mt-2"><strong>Total Payable:</strong> à¸¿<span id="rTotal"></span></p>
      </div>
    </div>
  </div>

<script>
  function monthDiff(d1, d2) {
    return (d2.getFullYear() - d1.getFullYear()) * 12 + (d2.getMonth() - d1.getMonth());
  }

  function toDateOnly(d) {
    return new Date(d.getFullYear(), d.getMonth(), d.getDate());
  }

  // default paid date = today
  window.onload = function () {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('paidDate').value = today;
  };

  function calculateDebt() {
    const cVal = document.getElementById('contractDate').value;
    const dVal = document.getElementById('dueDate').value;
    const pVal = document.getElementById('paidDate').value;
    const summaryPrice = parseFloat(document.getElementById('summaryPrice').value || 0);

    if (!cVal || !dVal || isNaN(summaryPrice)) {
      alert("Please fill Contract Date, Due Date and Summary Price.");
      return;
    }

    const contractDate = toDateOnly(new Date(cVal));
    const dueDate = toDateOnly(new Date(dVal));
    const paidDate = toDateOnly(new Date(pVal));

    // -----------------------------------------
    // BASE INTEREST (2%) â€“ capped at months(contract â†’ due)
    // -----------------------------------------
    let rawBasePaid = monthDiff(contractDate, paidDate);        // actual months paid
    let rawBaseDue = monthDiff(contractDate, dueDate);          // max months allowed

    let baseMonths = Math.min(
      Math.max(rawBasePaid, 0),   // cannot be negative
      rawBaseDue                  // cannot exceed contract â†’ due months
    );

    const baseAmount = summaryPrice + (summaryPrice * 0.02 * baseMonths);

    // -----------------------------------------
    // PENALTY INTEREST (5%/yr) â€“ starts AFTER due+1 month
    // -----------------------------------------
    let duePlus1 = new Date(dueDate);
    duePlus1.setMonth(duePlus1.getMonth() );

    let penaltyMonths = 0;
    if (paidDate > duePlus1) {
      penaltyMonths = monthDiff(duePlus1, paidDate);
      if (penaltyMonths < 0) penaltyMonths = 0;
    }

    const penaltyInterest = baseAmount * (0.05 / 12) * penaltyMonths;

    const total = baseAmount + penaltyInterest;

    // -----------------------------------------
    // DISPLAY
    // -----------------------------------------
    document.getElementById('result').classList.remove('hidden');
    document.getElementById('rBaseMonths').textContent = baseMonths + " month(s)";
    document.getElementById('rBaseAmount').textContent = baseAmount.toLocaleString(undefined, { minimumFractionDigits: 2 });
    document.getElementById('rPenaltyMonths').textContent = penaltyMonths + " month(s)";
    document.getElementById('rLate').textContent = penaltyInterest.toLocaleString(undefined, { minimumFractionDigits: 2 });
    document.getElementById('rTotal').textContent = total.toLocaleString(undefined, { minimumFractionDigits: 2 });
  }
</script>
</body>
</html>
