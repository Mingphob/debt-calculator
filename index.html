<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>KDX Interest Calculator</title>
  <style>
    body { font-family: Arial; padding: 20px; max-width: 600px; margin: auto; }
    .hidden { display: none; }
    .result-box { margin-top: 20px; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
  </style>
</head>

<body>

<h2>KDX Interest Calculator</h2>

<label>Contract Date:</label>
<input type="date" id="contractDate"><br><br>

<label>Due Date:</label>
<input type="date" id="dueDate"><br><br>

<label>Paid Date:</label>
<input type="date" id="paidDate"><br><br>

<label>Summary Price:</label>
<input type="number" id="summaryPrice"><br><br>

<button onclick="calculateDebt()">Calculate</button>

<div id="result" class="result-box hidden">
  <p><b>Base Interest:</b> <span id="rBaseMonths"></span></p>
  <p>Base Amount: <span id="rBaseAmount"></span></p>

  <p><b>Penalty:</b> <span id="rPenaltyMonths"></span></p>
  <p>Penalty Amount: <span id="rLate"></span></p>

  <hr>
  <p><b>Total:</b> <span id="rTotal"></span></p>
</div>


<script>
  // ตั้งค่า paid date เป็นวันนี้ทันที
  window.onload = function () {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('paidDate').value = today;
  };

  // --------------------------
  // ฟังก์ชันนับเดือนปฏิทิน + วันกำกับ (ใช้ทั้ง Base และ Penalty)
  // --------------------------
  function countMonthsByCalendarWithDay(d1, d2) {
    let months = (d2.getFullYear() - d1.getFullYear()) * 12 +
                 (d2.getMonth() - d1.getMonth());

    // ถ้าวันของปลายทางน้อยกว่า → เดือนยังไม่ถึง
    if (d2.getDate() < d1.getDate()) {
      months -= 1;
    }

    return Math.max(months, 0);
  }

  // ทำวันที่ให้เป็น date-only
  function toDateOnly(d) {
    return new Date(d.getFullYear(), d.getMonth(), d.getDate());
  }

  function calculateDebt() {
    const cVal = document.getElementById('contractDate').value;
    const dVal = document.getElementById('dueDate').value;
    const pVal = document.getElementById('paidDate').value;
    const summaryPrice = parseFloat(document.getElementById('summaryPrice').value || 0);

    if (!cVal || !dVal || isNaN(summaryPrice)) {
      alert("Please fill Contract Date, Due Date and Summary Price.");
      return;
    }

    const contractDate = toDateOnly(new Date(cVal));
    const dueDate = toDateOnly(new Date(dVal));
    const paidDate = toDateOnly(new Date(pVal));

    // -----------------------------------------
    // BASE INTEREST (2%) — capped at months(contract → due)
    // -----------------------------------------
    let rawBasePaid = countMonthsByCalendarWithDay(contractDate, paidDate);
    let rawBaseDue  = countMonthsByCalendarWithDay(contractDate, dueDate);

    let baseMonths = Math.min(rawBasePaid, rawBaseDue);
    const baseAmount = summaryPrice + (summaryPrice * 0.02 * baseMonths);

    // -----------------------------------------
    // PENALTY (5%/yr) — begins after due + 1 month
    // -----------------------------------------
    let duePlus1 = new Date(dueDate);
    duePlus1.setMonth(duePlus1.getMonth());

    let penaltyMonths = 0;
    if (paidDate > duePlus1) {
      penaltyMonths = countMonthsByCalendarWithDay(duePlus1, paidDate);
    }

    const penaltyInterest = baseAmount * (0.05 / 12) * penaltyMonths;
    const total = baseAmount + penaltyInterest;

    // -----------------------------------------
    // DISPLAY
    // -----------------------------------------
    document.getElementById('result').classList.remove('hidden');
    document.getElementById('rBaseMonths').textContent = baseMonths + " month(s)";
    document.getElementById('rBaseAmount').textContent = baseAmount.toLocaleString(undefined, { minimumFractionDigits: 2 });
    document.getElementById('rPenaltyMonths').textContent = penaltyMonths + " month(s)";
    document.getElementById('rLate').textContent = penaltyInterest.toLocaleString(undefined, { minimumFractionDigits: 2 });
    document.getElementById('rTotal').textContent = total.toLocaleString(undefined, { minimumFractionDigits: 2 });
  }
</script>

</body>
</html>
